<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IonosTek Monitor V4.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #0f0f13; --card-bg: #1a1a20; --text-main: #e0e0e0; --accent-green: #00ff9d; --accent-red: #ff4d4d; --accent-yellow: #ffc107; --border-color: #333; }
        body { font-family: 'Chakra Petch', sans-serif; background-color: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; }
        h1, h3 { margin: 0 0 10px 0; text-transform: uppercase; letter-spacing: 1px; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        .blink { animation: blinker 1.5s linear infinite; color: red; }
        @keyframes blinker { 50% { opacity: 0; } }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 1400px; margin: 0 auto; }
        .card { background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; padding: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .stats-container { grid-column: 1 / -1; display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-around; margin-bottom: 20px; }
        .stat-box { background: #252530; padding: 20px; border-radius: 8px; min-width: 200px; border-left: 4px solid #555; flex: 1; text-align: center; }
        .stat-value { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .stat-label { font-size: 0.9em; color: #aaa; }
        img { width: 100%; height: auto; border-radius: 5px; border: 1px solid #444; display: block; margin: 0 auto; }
        .footer { text-align: center; margin-top: 40px; font-size: 0.8em; color: #666; }
        .status-normal { color: var(--accent-green); border-left-color: var(--accent-green) !important; }
        .status-warn { color: var(--accent-yellow); border-left-color: var(--accent-yellow) !important; }
        .status-alert { color: var(--accent-red); border-left-color: var(--accent-red) !important; }
    </style>
</head>
<body>

    <div class="header">
        <h1>IONOSTEK <span style="color:var(--accent-green)">MONITOR V4.5</span></h1>
        <span>LIVE DASHBOARD • <span class="blink">●</span> ONLINE</span>
        <div id="updateTime" style="font-size: 0.9em; margin-top: 5px; color: #aaa;">Connecting to Satellites...</div>
    </div>

    <div class="dashboard">
        <div class="stats-container">
            <div class="stat-box" id="card-dst">
                <div class="stat-label">DST (WDC Kyoto)</div>
                <div class="stat-value" id="val-dst">--</div>
                <div class="stat-label">nT (Storm Strength)</div>
            </div>
            <div class="stat-box" id="card-bz">
                <div class="stat-label">Bz (Magnetic)</div>
                <div class="stat-value" id="val-bz">--</div>
                <div class="stat-label">nT (South is BAD)</div>
            </div>
            <div class="stat-box" id="card-wind">
                <div class="stat-label">Solar Wind</div>
                <div class="stat-value" id="val-wind">--</div>
                <div class="stat-label">km/s (Speed)</div>
            </div>
        </div>

        <div class="card">
            <h3>Aurora Forecast</h3>
            <img src="https://services.swpc.noaa.gov/images/aurora-forecast-northern-hemisphere.jpg" id="img-aurora" alt="Aurora">
        </div>
        <div class="card">
            <h3>HF Conditions</h3>
            <img src="https://www.hamqsl.com/solar101vhf.php" id="img-muf" alt="HF Conditions" style="border:none;">
        </div>
        <div class="card">
            <h3>Sun Monitor</h3>
            <img src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_512_0193.jpg" id="img-sun" alt="Sun">
        </div>
        <div class="card">
            <h3>X-Ray Flux</h3>
            <img src="https://services.swpc.noaa.gov/images/swx-overview-small.gif" id="img-xray" alt="X-Ray">
        </div>
        
        <div class="card" style="grid-column: 1 / -1;">
             <h3>Planetary K-Index (GFZ Potsdam)</h3>
             <img src="https://www-app3.gfz-potsdam.de/kp_index/Kp_nowcast.png" id="img-geospace" alt="Kp Index" style="background: rgba(255,255,255,0.1);">
        </div>
    </div>

    <div class="footer">
        IonosTek Monitor V4.5 • Data: NOAA / Kyoto / HamQSL / GFZ
    </div>

    <script>
        // 1. Bz (DSCOVR Mag)
        async function fetchBz() {
            try {
                const res = await fetch('https://services.swpc.noaa.gov/products/solar-wind/mag-5-minute.json');
                if (!res.ok) throw new Error('Network');
                const data = await res.json();
                if (data && data.length > 1) {
                    const last = data[data.length - 1];
                    const bz = parseFloat(last[3]); 
                    updateStat('val-bz', 'card-bz', bz, 'bz');
                }
            } catch (e) { console.error("Bz Error", e); document.getElementById('val-bz').innerText = "N/A"; }
        }

        // 2. Wind Speed (DSCOVR Plasma)
        async function fetchWind() {
            try {
                const res = await fetch('https://services.swpc.noaa.gov/products/solar-wind/plasma-5-minute.json');
                if (!res.ok) throw new Error('Network');
                const data = await res.json();
                if (data && data.length > 1) {
                    const last = data[data.length - 1];
                    const speed = parseFloat(last[2]);
                    updateStat('val-wind', 'card-wind', speed, 'wind');
                }
            } catch (e) { console.error("Wind Error", e); document.getElementById('val-wind').innerText = "N/A"; }
        }

        // 3. Dst (Kyoto)
        async function fetchDst() {
            try {
                const res = await fetch('https://services.swpc.noaa.gov/products/kyoto-dst.json');
                if (!res.ok) throw new Error('Network');
                const data = await res.json();
                if (data && data.length > 1) {
                    const last = data[data.length - 1];
                    const dst = parseInt(last[1]); 
                    updateStat('val-dst', 'card-dst', dst, 'dst');
                }
            } catch (e) { console.error("Dst Error", e); document.getElementById('val-dst').innerText = "N/A"; }
        }

        function updateStat(elemId, cardId, value, type) {
            const elem = document.getElementById(elemId);
            const card = document.getElementById(cardId);
            if (!elem || !card) return;

            elem.innerText = isNaN(value) ? "--" : value;
            card.className = 'stat-box'; 
            if (type === 'dst') {
                if (value < -50) card.classList.add('status-alert');
                else if (value < -20) card.classList.add('status-warn');
                else card.classList.add('status-normal');
            } else if (type === 'bz') {
                if (value < -5) card.classList.add('status-alert');
                else if (value < 0) card.classList.add('status-warn');
                else card.classList.add('status-normal');
            } else if (type === 'wind') {
                if (value > 600) card.classList.add('status-alert');
                else if (value > 400) card.classList.add('status-warn');
                else card.classList.add('status-normal');
            }
        }

        function updateAll() {
            fetchBz(); fetchWind(); fetchDst();
            document.getElementById('updateTime').innerText = "Updated: " + new Date().toLocaleTimeString();
        }

        function refreshImages() {
            const images = document.querySelectorAll('img');
            const timestamp = new Date().getTime();
            images.forEach(img => {
                let src = img.src.split('?')[0];
                img.src = src + '?t=' + timestamp;
            });
        }

        updateAll();
        setInterval(updateAll, 60000); 
        setInterval(refreshImages, 300000); 
    </script>
</body>
</html>
